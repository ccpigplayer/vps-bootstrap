# 🦞 VPS Bootstrap Pro

一个面向 Ubuntu/Debian VPS 的**交互式一键初始化脚本**，重点解决：

- 新机首次初始化麻烦
- SSH 加固容易把自己锁死
- 多台机器缺少统一审计记录

> 默认不安装防火墙（按当前项目需求），但提供 SSH 两阶段安全切换与 Fail2ban 严格防护。

---

## ✨ 核心特性

- 🎨 **美化交互 UI**：彩色步骤提示、菜单式输入
- 🔐 **SSH 两阶段防锁死流程**
  1. 先改端口 + 禁 root（暂保留密码）
  2. 人工验证新端口可登录
  3. 再切换到仅秘钥登录（可选）
- 🚫 **Fail2ban 严格策略**：10 分钟内失败 3 次，封禁 24 小时
- 🔁 **端口自动同步**：Fail2ban 自动跟随你的 SSH 新端口
- ⚡ **BBR 启用**：优化 TCP 拥塞控制
- 🧹 **系统维护**：更新 + 自动清理旧依赖
- 🌍 **时区选择**：上海、香港、新加坡、首尔、洛杉矶、东京（默认上海）
- 📝 **审计日志落盘**：
  - 全量日志：`/var/log/vps-bootstrap/bootstrap-时间戳.log`
  - 摘要日志：`/var/log/vps-bootstrap/bootstrap-summary-时间戳.txt`

---

## ✅ 支持系统

- Ubuntu 22.04 / 24.04
- Debian 12

---

## 🚀 快速开始

```bash
chmod +x server-bootstrap.sh
sudo ./server-bootstrap.sh
```

脚本将交互式引导你完成：

1. 时区选择
2. SSH 新端口设置
3. 登录策略（仅秘钥 / 保留密码）
4. （若仅秘钥）用户名与公钥写入
5. 第一阶段 SSH 应用
6. 你在本地新终端验证
7. 第二阶段切换（关闭密码登录）

---

## 🔎 执行后必做

1. **不要先关闭当前会话**
2. 新开终端测试：

```bash
ssh -p <新端口> <用户名>@<服务器IP>
```

3. 确认成功后再退出旧会话
4. 建议重启：

```bash
sudo reboot
```

---

## 📂 项目结构

```text
.
├── server-bootstrap.sh      # 主脚本
├── bootstrap-playbook.md    # 使用与流程说明
├── CHANGELOG.md
├── LICENSE
└── README.md
```

---

## ⚠️ 安全说明

- 修改 SSH 端口只能降低扫描噪音，不是绝对安全。
- 建议使用仅秘钥登录，并确保公钥验证通过后再禁密码。
- 本项目当前版本**不安装防火墙**，请根据你的网络环境自行补充。

---

## 📜 License

MIT
